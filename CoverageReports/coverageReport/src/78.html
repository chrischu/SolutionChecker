<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>d:\development\solutioninspector\src\solutioninspector.api\commands\initializecommand.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.IO;
using SolutionInspector.Api.Extensions;
using Wrapperator.Interfaces;
using Wrapperator.Interfaces.IO;
using Wrapperator.Interfaces.Reflection;

namespace SolutionInspector.Api.Commands
{
  internal class InitializeCommand : SolutionInspectorCommand&lt;InitializeCommand.RawArguments, InitializeCommand.ParsedArguments&gt;
  {
    private readonly IAssembly _resourceAssembly;
    private readonly IFileStatic _file;
    private readonly IConsoleStatic _console;

    public InitializeCommand (IAssembly resourceAssembly, IFileStatic file, IConsoleStatic console)
        : base(&quot;initialize&quot;, &quot;Creates a new SolutionInspector configuration file or overwrite an existing one.&quot;)
    {
      _resourceAssembly = resourceAssembly;
      _file = file;
      _console = console;
    }

    protected override void SetupArguments (IArgumentsBuilder&lt;RawArguments&gt; argumentsBuilder)
    {
      argumentsBuilder
          .Flag(&quot;force&quot;, &quot;f&quot;, &quot;Overwrite file if it exists without asking for confirmation.&quot;, (a, v) =&gt; a.Force = v)
          .Values(c =&gt; c.Value(&quot;configFilePath&quot;, (a, v) =&gt; a.ConfigFilePath = v));
    }

    protected override ParsedArguments ValidateAndParseArguments (RawArguments arguments, Func&lt;string, Exception&gt; reportError)
    {
      return new ParsedArguments(arguments.ConfigFilePath, arguments.Force);
    }

    protected override int Run (ParsedArguments arguments)
    {
      if (_file.Exists(arguments.ConfigFilePath) &amp;&amp; !arguments.Force)
      {
        _console.Write($&quot;File &#39;{arguments.ConfigFilePath}&#39; already exists. Do you want to overwrite it? [y/N] &quot;);
        var answer = _console.ReadLine();
        if (string.IsNullOrEmpty(answer) || !string.Equals(answer, &quot;y&quot;, StringComparison.OrdinalIgnoreCase))
        {
          _console.WriteLine(&quot;Command was aborted.&quot;);
          return 1;
        }
      }

      using (var sourceStream = _resourceAssembly.GetManifestResourceStream(&quot;SolutionInspector.Template.SolutionInspectorConfig&quot;).AssertNotNull())
      using (var destinationStream = _file.Open(arguments.ConfigFilePath, FileMode.Create))
        sourceStream.CopyTo(destinationStream);

      return 0;
    }

    public class RawArguments
    {
      public string ConfigFilePath { get; set; }
      public bool Force { get; set; }
    }

    public class ParsedArguments
    {
      public string ConfigFilePath { get; }
      public bool Force { get; }

      public ParsedArguments (string configFilePath, bool force)
      {
        ConfigFilePath = configFilePath;
        Force = force;
      }
    }
  }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,11,17,113,1],[19,7,19,44,1],[20,7,20,20,1],[21,7,21,26,1],[22,5,22,6,1],[26,7,27,105,1],[27,116,28,24,1],[28,81,28,83,1],[29,5,29,6,1],[33,7,33,77,1],[38,7,38,70,1],[40,9,40,114,1],[41,9,41,42,1],[42,9,42,109,1],[44,11,44,54,1],[45,11,45,20,1],[49,14,49,146,1],[50,14,50,91,1],[51,9,51,48,1],[53,7,53,16,1],[58,38,58,42,1],[58,43,58,47,1],[59,27,59,31,1],[59,32,59,36,1],[64,38,64,42,1],[65,27,65,31,1],[67,7,67,65,1],[69,9,69,41,1],[70,9,70,23,1],[71,7,71,8,1],[27,105,27,116,1],[28,24,28,60,1],[28,80,28,81,1],[28,60,28,80,1]]);
    </script>
  </body>
</html>